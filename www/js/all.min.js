"use strict";function jsonCallback(e){return angular.element(document.getElementById("main")).scope().jsonCallback(e),e}angular.module("places5",["ionic","ngResource","places5.data"]).run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("main",{url:"/main",templateUrl:"main.html",controller:"mainCtrl"}).state("fav",{url:"/fav",templateUrl:"fav.html",controller:"favCtrl"}).state("info",{url:"/info",templateUrl:"info.html",controller:"infoCtrl"}).state("map",{url:"/map",templateUrl:"map.html",controller:"mapCtrl"}).state("details",{url:"/details",templateUrl:"details.html",controller:"detailsCtrl"}),t.otherwise("/main")}]).factory("compass",["$timeout",function(e){return{magneticHeading:null,onSuccess:function(e){window.alert("Heading: "+e.magneticHeading)},onError:function(e){window.alert("Compass Error: "+e.code)},getCurrentHeading:function(t,a){if(!navigator.compass)return void a();var s=t||this.onSuccess,n=a||this.onError;null===this.magneticHeading?(this.magneticHeading=!0,navigator.compass.getCurrentHeading(function(){},function(){}),e(function(){navigator.compass.getCurrentHeading(s,n)},1e3)):navigator.compass.getCurrentHeading(s,n)}}}]).factory("gps",["$q",function(e){return{toRadians:function(e){return e*Math.PI/180},toDegrees:function(e){return 180*e/Math.PI},getCurrentPosition:function(t){t=t||5e3;var a=e.defer();return navigator.geolocation.getCurrentPosition(function(e){a.resolve(e)},function(e){a.reject(e)},{timeout:t}),a.promise},getDistance:function(e,t,a,s){if(void 0===e||void 0===t||void 0===a||void 0===s)return"";Number.prototype.toRadians=function(){return this*Math.PI/180};var n=6371,r=(a-e).toRadians(),i=(s-t).toRadians();e=e.toRadians(),a=a.toRadians();var o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e)*Math.cos(a)*Math.sin(i/2)*Math.sin(i/2),c=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)),u=n*c;return u},getPct:function(e){var t=0>e?-1:1;return Math.min(7.5*Math.abs(e),45)*t},getXY:function(e,t){var a=45;e=this.getPct(e),t=this.getPct(t);var s=Math.sqrt(e*e+t*t);if(s>a){var n=t/e*180/Math.PI;e=Math.cos(n)*a,t=Math.sin(n)*a}return[e+"%",t+"%"]}}}]).service("restaurants",["$resource","$q","restaurantData","gps",function(e,t,a,s){var n=this;this.page=0,this.selected_restaurant_index=0,this.currentPosition={},this.loadData=function(){var e=localStorage.fivePlacesRestaurantList;return e?JSON.parse(e):a},this.saveData=function(){localStorage.fivePlacesRestaurantList=JSON.stringify(n.restaurant_list)},this.restaurant_list=this.loadData(),this.getRestaurantList=function(){return this.restaurant_list},this.setRestaurantList=function(e){return n.restaurant_list=e,n.restaurant_list},this.updateDistance=function(e){n.currentPosition=e;for(var t=n.currentPosition.coords.latitude,a=n.currentPosition.coords.longitude,r=0,i=n.restaurant_list.length;i>r;r++){var o=n.restaurant_list[r];o.index=r,o.X=111.19*(o.Latitude-t),o.Y=111.19*(o.Longitude-a);var c=s.getXY(o.X,o.Y);o.left=c[0],o.top=c[1],o.distance=s.getDistance(t,a,parseFloat(o.Latitude),parseFloat(o.Longitude)).toFixed(1)+" km"}return n.restaurant_list},this.getPosition=function(){s.getCurrentPosition().then(function(e){return n.updateDistance(e)},function(e){window.alert("GPS error\ncode: "+e.code+"\nmessage: "+e.message+"\n")})},this.changeSelectedRestaurantIndex=function(e){return this.selected_restaurant_index=e,e},this.changePage=function(e){return this.page=e,e},this.restaurants_resource=e("https://dl.dropboxusercontent.com/u/16617673/restaurants.json",{},{query:{method:"JSONP",isArray:!0,cache:!1}}),this.refresh=function(){var e=t.defer();return this.restaurants_resource.query(function(t){n.setRestaurantList(t),n.updateDistance(n.currentPosition),e.resolve(t)},function(t){e.reject(t)}),e.promise}}]).factory("favourites",[function(){return{get:function(e){var t;return void 0===e?(t=localStorage.fivePlaces,t?JSON.parse(t):[]):(t=localStorage.fivePlaces,JSON.parse(t)[e])},add:function(e){var t=localStorage.fivePlaces;t=t?JSON.parse(t):[],-1==t.indexOf(e)&&t.push(e),localStorage.fivePlaces=JSON.stringify(t)},delete_fav:function(e){var t=localStorage.fivePlaces;t=t?JSON.parse(t):[];var a=t.indexOf(e);-1!=a&&(t.splice(a,1),localStorage.fivePlaces=JSON.stringify(t))}}}]).controller("mainCtrl",["$scope","$ionicActionSheet","compass","gps","restaurants","favourites",function(e,t,a,s,n,r){function i(e){for(var t=e.length,a=0,s=0,n=0;t>a;a++){var r=e[a];s+=parseFloat(r.Latitude),n+=parseFloat(r.Longitude)}return{coords:{latitude:s/t,longitude:n/t}}}function o(e,t,a){for(var s=[],n=t*a,r=0;a>r;r++)s[r]=e[n+r];return s}e.page=n.page,e.restaurants=o(n.getRestaurantList(),e.page,5);var c=i(e.restaurants);n.updateDistance(c),n.getPosition(),e.selected_restaurant_index=n.selected_restaurant_index,e.active_index=e.selected_restaurant_index%5,e.selected_restaurant=n.getRestaurantList()[e.selected_restaurant_index],e.currentHeading=0,e.doRefresh=function(){n.refresh().then(function(){e.restaurants=o(n.getRestaurantList(),e.page,5),e.change_restaurant(e.selected_restaurant_index),n.saveData()},function(e){console.log(e)}),e.$broadcast("scroll.refreshComplete")},e.jsonCallback=function(t){n.setRestaurantList(t),n.updateDistance(n.currentPosition),e.restaurants=o(n.getRestaurantList(),e.page,5),e.change_restaurant(e.selected_restaurant_index),n.saveData()},e.change_restaurant=function(t){t=5*e.page+t,e.selected_restaurant_index=n.changeSelectedRestaurantIndex(t),e.selected_restaurant=n.getRestaurantList()[t],e.active_index=e.selected_restaurant_index%5},e.next=function(){e.page=n.changePage(e.page+1);var t=5*e.page;t>=n.getRestaurantList().length&&(e.page=0,t=0),e.restaurants=n.getRestaurantList().slice(t,t+5),e.selected_restaurant_index=n.changeSelectedRestaurantIndex(t),e.active_index=e.selected_restaurant_index%5,e.selected_restaurant=n.getRestaurantList()[t]},e.show=function(){t.show({buttons:[{text:'<i class="icon ion-ios7-information"></i> Info'},{text:'<i class="icon ion-android-location"></i> Map'},{text:'<i class="icon ion-ios7-heart"   ></i> Add'}],cancelText:'<i class="icon ion-close-circled"></i> Cancel',buttonClicked:function(t){return 2==t&&r.add(e.selected_restaurant_index),!0},destructiveButtonClicked:function(){return!0}})}}]).controller("favCtrl",["$scope","$ionicActionSheet","$timeout","$state","restaurants","favourites",function(e,t,a,s,n,r){e.restaurants=n.restaurant_list,n.getPosition();var i=r.get();e.favourites=[];for(var o=0,c=i.length;c>o;o++){var u=i[o],l=e.restaurants[u];l.index=u,e.favourites.push(l)}e.info=function(e){n.changeSelectedRestaurantIndex(e),s.go("details")},e.map=function(e){n.changeSelectedRestaurantIndex(e),s.go("map")},e.delete_fav=function(t){r.delete_fav(t);for(var a=0,s=e.favourites.length;s>a;a++)if(e.favourites[a].index==t){e.favourites.splice(a,1);break}},e.show=function(a){t.show({buttons:[{text:'<i class="icon ion-ios7-information"></i> Info'},{text:'<i class="icon ion-android-location"></i> Map'}],destructiveText:'<i class="icon ion-minus-circled"></i> Delete',cancelText:'<i class="icon ion-close-circled"></i> Cancel',buttonClicked:function(t){switch(t){case 0:e.info(a);break;case 1:e.map(a)}return!0},destructiveButtonClicked:function(){return e.delete_fav(a),!0}})}}]).controller("detailsCtrl",["$scope","restaurants","favourites",function(e,t,a){e.selected_restaurant_index=t.selected_restaurant_index,e.restaurant=t.restaurant_list[e.selected_restaurant_index],e.favourites=a,e.addToFavourites=function(e){document.getElementById("id-fav-add").classList.toggle("fav-add",!0),a.add(e),window.setTimeout(function(){document.getElementById("id-fav-add").classList.toggle("fav-add",!1)},1e3)}}]).controller("mapCtrl",["$scope","restaurants",function(e,t){e.selected_restaurant_index=t.selected_restaurant_index,e.restaurant=t.restaurant_list[e.selected_restaurant_index];var a=new google.maps.LatLng(parseFloat(e.restaurant.Latitude),parseFloat(e.restaurant.Longitude)),s={zoom:18,center:a};e.map=new google.maps.Map(document.getElementById("map-canvas"),s);new google.maps.Marker({position:a,map:e.map,title:e.restaurant.Name})}]),angular.module("places5.data",[]).value("restaurantData",[{Name:"lades menemen",Type:"Local restaurant","Best for":"Breakfast and lunch",Ambient:"None but might be appealing for some",Price:"Very reasonable",Location:"Easy to find","Famous Dish":'"Menemen" and other egg dishes',Latitude:"2.284602",Longitude:"103.847083",Images:["http://s3-us-west-2.amazonaws.com/5places2eat/images/lades_01.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/lades_02.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/lades_03.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/lades_04.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/lades_05.jpg"],Explanation:'"Menemen" (a traditional scrambled egg dish) is a must and LADES is the best place to eat it. It\'s egg, tomatoes and green pepper (sometimes onions as well). Egg with cheese or egg with sausage (actually "sucuk" which is a traditional dried sausage product and it\'s great for egg dishes) are other great choices. Or you can have just egg, still very good.  We like to have "bal & kaymak" ( honey and dairy cream ) as a side dish to make this breakfast complete. You can have tea and fizzy drinks but no coffee. Waiters do not speak english but they are very friendly and here            are some language tips:  Scrambled : "karismis"  Half cooked : "az pismis"'},{Name:"bursa kebapçısı",Type:"Local restaurant","Best for":"Lunch",Ambient:"Cousy and retro",Price:"Reasonable",Location:"Easy to find","Famous Dish":"İskender Kebap",Latitude:"1.336022",Longitude:"103.861712",Images:["http://s3-us-west-2.amazonaws.com/5places2eat/images/bursakebapcisi_01.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/bursakebapcisi_02.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/bursakebapcisi_03.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/bursakebapcisi_04.jpg"],Explanation:"It is traditional and very famous kebab dish prepared from doner with hot tomato sauce over pieces of pita bread, slathered with butter and yogurt. Iskender Kebap can be found almost in any kebap restaurant but we believe this one is the closest to the original which you can only eat in city of Bursa (where this kebap has invented in late 19 century). You can order a 1,5 portion.  As dessert, you should try Kemalpaşa (fried dough served with cream) which is an another classic from Bursa. Fizzy drinks, ayran (yoghurty refreshing drink) and şıra (sour grape juice) are available.  Waiters do not speak english (because it’s not very likely to see any tourist inside) but you will be most welcomed. They kept the original decor from late 70’s and we like it this way."},{Name:"çakmak cafe",Type:"Local restaurant","Best for":"Lunch",Ambient:"Cousy and retro",Price:"Reasonable",Location:"Easy to find","Famous Dish":"İskender Kebap",Latitude:"1.323111",Longitude:"103.825348",Images:["http://s3-us-west-2.amazonaws.com/5places2eat/images/cakmak_01.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/cakmak_02.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/cakmak_03.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/cakmak_04.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/cakmak_05.jpg"],Explanation:"CAKMAKCAFECAKMAKCAFECAKMAKCAFECAKMAKCAFECAKMAKCAFECAKMAKCAFECAKMAKCAFECAKMAKCAFECAKMAKCAFECAKMAKCAFECAKMAKCAFECAKMAKCAFECAKMAKCAFE"},{Name:"sehzade cag kebap",Type:"Local restaurant","Best for":"Lunch",Ambient:"Cousy and retro",Price:"Reasonable",Location:"Easy to find","Famous Dish":"İskender Kebap",Latitude:"1.280251",Longitude:"103.856664",Images:["http://s3-us-west-2.amazonaws.com/5places2eat/images/sehzade_01.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/sehzade_02.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/sehzade_03.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/sehzade_04.jpg","http://s3-us-west-2.amazonaws.com/5places2eat/images/sehzade_05.jpg"],Explanation:"SEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADESEHZADE"},{Name:"RESTAURANT_TEST01",Type:"Local restaurant","Best for":"Lunch",Ambient:"Cousy and retro",Price:"Reasonable",Location:"Easy to find","Famous Dish":"İskender Kebap",Latitude:"1.293765",Longitude:"103.872371",Images:["http://s3-us-west-2.amazonaws.com/5places2eat/images/sehzade_01.jpg"],Explanation:"TESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTEST"}]);